{% extends "::base.html.twig" %}

{% block stylesheets %}
	{{ parent() }}
	<link href="{{ asset('bundles/raykupage/css/innerstyle.css') }}" type="text/css" rel="stylesheet" media="screen" />
{% endblock %}

{% block content %}
<div class="dashboard">
    <!--Sidebar-->
		<div class="large-3 columns sidebar">
    		<div class="row tutor-sidebar">
                <div class="small-12 columns tutor-label">
                    <h5>Tutor</h5>
                    <div class="tutor-switch">
                        <label><input type="radio" name="toggle" id="tutorOn"><span>On</span></label>
                        <label><input type="radio" name="toggle" id="tutorOff" checked="checked"><span>Off</span></label>
                    </div>
    		    </div>
    		</div>
    		{% if app.user.isTutor %}
	            <div class="row tutor-status-bar">
	                <div class="small-12 columns tutor-status">
	                    <h5>Status <span>
	                    {% if app.user.tutor.isOnline %}
	                    	Online
	                    {% else %}
	                    	Offline
	                    {% endif %}
	                    </span></h5>
	                </div>
	            </div>
	        {% endif %}

            <div class="row tutor-selected">
                <h5><span class="tutor-count">0</span> <span class="tright">Tutor(s) Selected</span> </h5>
                <div class="small-12 columns">
                    <ol id="selectedTutors">
                    </ol>
                    <a href=# class="clear-tutors">Clear All</a>
                </div>
            </div>
		</div>
    <!--End Sidebar-->

    <!--Main Content-->
	<div class="large-9 columns main-content">
        <!-- User Profile -->
        <div class="row user-profile">
            <div class="large-12 columns user-profile-top">
                <h6><a href="#" title="Buy Rayku Points" class="rayku-points">{{app.user.points}}RP</a></h6>
                <h5>Student</h5>
            </div>
            <div class="large-12 columns user-rayku-points">
                <form class="buy-rayku-points custom" name="buy_rayku_points">
                    <div class="row">
                        <div class="large-6 large-offset-2 columns">
                            <label for="customDropdown1">You have <span class="rpoints">0</span> Rayku Points. Buy Some More.</label>
                            <select id="customDropdown1" class="large">
                                <option DISABLED>Points</option>
                                <option>500 Points for $5</option>
                                <option>1000 Points for $10</option>
                                <option>2500 Points for $25</option>
                                <option>5000 Points for $50</option>
                                <option>10000 Points for $100</option>
                            </select>
                        </div>
                        <div class="large-4 columns">
                            <input type="submit" class="bbutton" value="Buy">
                        </div>
                    </div>
                </form>
            </div>
            <div class="large-3 columns user-profile-image">
                <img src="{{ asset('bundles/raykupage/images/profile_image_blank.jpg') }}">
            </div>  
            <div class="large-9 columns user-profile-info">
                <ul class="user-profile-items">
                    <li>
                        <a href="#" class="raphael edit-tool">></a>
                        <form class="user-profile-edit-form" name="name">
                            <label>Name</label>
                            <input type="text" placeholder="Nick" name="current_firstname" class="form-field">
                            <input type="text" placeholder="Agopoulos" name="current_lastname" class="form-field">
                            <input type="submit" class="bbutton" value="Save">
                            <a href=# class="close-edit">x</a>
                        </form>
                        <h4><span class="name edit">Nick Agopoulos</span></h4>
                    </li>
                    <li>
                        <a href="#" class="raphael edit-tool">></a>
                        <form class="user-profile-edit-form" name="education">
                            <label>Education</label>
                            <input type="text" placeholder="3rd Year" name="current_year" class="form-field">
                            <input type="text" placeholder="Under Graduate Student" name="current_level" class="form-field">
                            <input type="submit" class="bbutton" value="Save">
                            <a href=# class="close-edit">x</a>
                        </form>
                        <h5><span class="education edit">3rd Year, Under Graduate Student</span></h5></li>
                    <li>
                        <a href="#" class="raphael edit-tool">></a>
                        <form class="user-profile-edit-form" name="location">
                            <label>Location</label>
                            <input type="text" placeholder="Toronto" name="current_city" class="form-field">
                            <input type="text" placeholder="Canada" name="current_country" class="form-field">
                            <input type="submit" class="bbutton" value="Save">
                            <a href=# class="close-edit">x</a>
                        </form>
                        <h6>Lives in <span class="location edit"><a>Toronto, Canada</a></span></h6>
                    </li>
                    <li class="cutoff">
                        <a href="#" class="raphael edit-tool">></a>
                        <form class="user-profile-edit-form" name="email">
                            <label>Email</label>
                            <input type="text" placeholder="nick@rayku.com" name="current_email" class="form-field">
                            <input type="submit" class="bbutton" value="Save">
                            <a href=# class="close-edit">x</a>
                        </form>
                        <span>Email:</span> <span class="email edit">nick@rayku.com</span>
                    </li>
                    <li>
                        <a href="#" class="raphael edit-tool">></a>
                        <form class="user-profile-edit-form" name="university">
                            <label>University</label>
                            <input type="text" placeholder="Ryerson University" name="current_university" class="form-field">
                            <input type="submit" class="bbutton" value="Save">
                            <a href=# class="close-edit">x</a>
                        </form>
                        <span>School:</span> <span class="university edit">Ryerson University</span>
                    </li>
                    <li>
                        <a href="#" class="raphael edit-tool">></a>
                        <form class="user-profile-edit-form" name="degree">
                            <label>Degree</label>
                            <input type="text" placeholder="Economics" name="current_degree" class="form-field">
                            <input type="submit" class="bbutton" value="Save">
                            <a href=# class="close-edit">x</a>
                        </form>
                        <span>Degree:</span> <span class="degree edit">Economics</span>
                    </li>
                    <li>
                        <a href="#" class="raphael edit-tool">></a>
                        <form class="user-profile-edit-form" name="biography">
                            <label>Bio</label>
                            <textarea class="form-field" name="current_biography"></textarea>
                            <input type="submit" class="bbutton" value="Save">
                            <a href=# class="close-edit">x</a>
                        </form>
                        <span>Bio:</span> <span class="biography edit">This is longer content Donec id elit non mi porta gravida at eget metus.</span></li>
                </ul>
                <ul class="user-profile-buttons">
                    <li><a href=# class="bbutton edit-button"><span class="raphael">></span>Edit Profile</a></li>
                    <li>
                      <form name="master-form" class="user-profile-master-form">
                        <input type="text" name="firstname">
                        <input type="text" name="lastname">
                        <input type="text" name="year">
                        <input type="text" name="level">
                        <input type="text" name="city">
                        <input type="text" name="country">
                        <input type="text" name="email">
                        <input type="text" name="university">
                        <input type="text" name="degree">
                        <input type="text" name="biography">
                        <input type="submit" value="Done Editing" class="bbutton done-button">
                      </form>
                    </li>
                </ul>
            </div>
            <script>
            $(function(){
                var change = 0;
                //On submitting each individual form
                $('form.user-profile-edit-form').on('submit', function(event){
                    event.preventDefault(); //prevent reloading page by clicking submit
                    var current_form_name = $(this).attr('name'); //get the current form name
                    var valarr = []; //declare an empty array
                    console.log(current_form_name);

                    //for each input field with class .form-field within the current form
                    $('form[name="'+current_form_name+'"] .form-field').each(function(){
                        var field_value = $(this).val(); //get the field value
                        var field_name = $(this).attr('name').split("_"); //get the field name and split it to get the appropriate identifier

                        //set the equivalent input field in master form to the value of the current input field
                        $('form.user-profile-master-form input[name="'+ field_name[1] +'"]').val(field_value);
                        valarr.push(field_value); //push the value into an array

                        //Log to console
                        console.log(field_name);
                        console.log(field_value);
                        console.log('New Value:' + $('form.user-profile-master-form input[name="'+ field_name[1] +'"]').val());
                    });

                    // To display on the page if the form had one or more fields
                    if(valarr.length > 1){
                        $('.'+current_form_name).html(valarr.join(", "));
                    }
                    else{
                        $('.'+current_form_name).html(valarr.join(""));
                    }
                    //Hide the current form
                    $(this).hide(100);
                    return false;
                });

                //When done profile editing, submit the form. Should be done via Ajax
                $('form.user-profile-master-form').on('submit', function(event){
                    event.preventDefault(); //prevent reloading page by clicking submit

                    //For each input of type 'text' within the form, get their value and print it out
                    $('form.user-profile-master-form input[type="text"]').each(function(){
                        //if input value is not null print it
                        if($(this).val() !== ""){
                            console.log('Value: ' + $(this).val());
                            change++;
                        }
                    });
                    //determine if any change was made
                    if (change > 0){
                        console.log('Changes Were Made');
                        change = 0;
                    }
                    else if(change === 0){
                        console.log('No Change');
                    }
                });

                //slide down rayku points form
                $('.rayku-points').click(function(event){
                    event.preventDefault();
                    $('.user-rayku-points').slideToggle();
                });
            });
            </script>
            <!--End Profile Info-->
            <div class="large-12 columns user-divider">
            </div>
            <!--Ask Form-->
            <div class="large-12 columns ask">
              <form class="custom">
                <div class="row">
                  <div class="large-3 columns ask-q">
                    <h5>Find suitable tutor for</h5>
                  </div>
                  <div class="large-3 columns school">
                    <!--
                    <select id="schoolSelect" class="medium" name="school">
                      <option>Choose Institution</option>
                      <option value="high school" name="selectlevel">High School</option>
                      <option value="university" name="selectlevel">University</option>
                    </select>
                    //-->
                  </div>

                  <div class="large-3 columns institution" id="placeholder">
                    <!--
                    <select id="instSelect" class="medium" disabled>
                        <option value="Choose" name="choose" id="choose">Select An Institution</option>
                    </select>
                    //-->
                  </div>

                  <div class="large-3 columns institution" id="highschool">
                    <!--
                    <select name="highschool" class="medium" disabled>
                        <option value="Choose" name="choose" id="choose">Choose Grade</option>
                        <option value="grade 1">Grade 1</option>
                        <option value="grade 2">Grade 2</option>
                        <option value="grade 3">Grade 3</option>
                        <option value="grade 4">Grade 4</option>
                        <option value="grade 5">Grade 5</option>
                        <option value="grade 6">Grade 6</option>
                        <option value="grade 7">Grade 7</option>
                        <option value="grade 8">Grade 8</option>
                        <option value="grade 9">Grade 9</option>
                        <option value="grade 10">Grade 10</option>
                        <option value="grade 11">Grade 11</option>
                        <option value="grade 12">Grade 12</option>
                    </select>
                    //-->
                  </div>
                  <div class="large-3 columns institution" id="university">
                    <!--
                    <select name="university" class="medium" disabled>
                        <option value="Choose" name="choose" id="choose">Choose Year</option>
                        <option value="year 1">Year 1</option>
                        <option value="year 2">Year 2</option>
                        <option value="year 3">Year 3</option>
                        <option value="year 4">Year 4</option>
                        <option value="year 5">Year 5</option>
                    </select>
                    //-->
                  </div>

                  <div class="large-3 columns category">
                    <select id="categorySelect" class="medium" name="category">
                      <option>Choose Category</option>
                      <option value="General Math">General Math</option>
                      <option value="Pre-Algebra">Pre-Algebra</option>
                      <option value="Geometry">Geometry</option>
                      <option value="Algebra">Algebra</option>
                      <option value="Trigonometry">Trigonometry</option>
                      <option value="Calculus">Calculus</option>
                      <option value="Statistics">Statistics & Probability</option>
                      <option value="Advanced Math">Advanced Math</option>
                    </select>
                  </div>

                  <div class="large-12 columns question-container">
                    <div class="input-container">
                      <input type="text" placeholder="What is your question? Or view online tutors" name="ask">
                    </div>
                    <input type="submit" class="bbutton" value="View Online Tutors" name="aSubmit">
                  </div>
                </div>
              </form>
            </div>
            <!--End Ask Form-->
        </div>

      
    <!--Tutor List-->
    <div class="row tutor-list">
     Loading ...
    </div>
  </div>
  <!--End Tutor List-->
</div>

<div id="myTutorModal" class="reveal-modal medium">
  <h2>Complete Your Tutor Profile</h2>
  <div class="large-12 columns">
    <p>Before activating your tutor status, please fill out as much as possible to completeyour tutor profile.</p>
  </div>
  <div class="large-12 columns">
    <form class="custom">
      <div class="row">
        <div class="row subjects">
          <div class="large-12 columns">
            <label>What subjects are you comfortable teaching?</label>
            <label for="checkbox1"><input name="checkbox1" type="checkbox" id="checkbox1" style="display:none;"><span class="custom checkbox"></span> General Math</label>
            <label for="checkbox1"><input name="checkbox1" type="checkbox" id="checkbox1" style="display:none;"><span class="custom checkbox"></span> Pre-Algebra</label>
            <label for="checkbox1"><input name="checkbox1" type="checkbox" id="checkbox1" style="display:none;"><span class="custom checkbox"></span> Geometry</label>
            <label for="checkbox1"><input name="checkbox1" type="checkbox" id="checkbox1" style="display:none;"><span class="custom checkbox"></span> Algebra</label>
            <label for="checkbox1"><input name="checkbox1" type="checkbox" id="checkbox1" style="display:none;"><span class="custom checkbox"></span> Trigonometry</label>
            <label for="checkbox1"><input name="checkbox1" type="checkbox" id="checkbox1" style="display:none;"><span class="custom checkbox"></span> Calculus</label>
          </div>
        </div>

        <div class="row describes">
          <div class="large-12 columns">
            <label>What best describes you?</label>
            <select id="customDropdown1" class="large">
              <option DISABLED>What describes you</option>
              <option>Freshman</option>
              <option>Sophomore</option>
              <option>Junior</option>
              <option>Senior</option>
              <option selected>Under Graduate Degree Holder</option>
              <option>Masters Sutdent</option>
              <option>Masters Degree Holder</option>
              <option>Phd Candidate</option>
              <option>Phd Degree Holder</option>
              <option>Teaching Assistant</option>
              <option>Professor</option>
              <option>Middle School Teacher</option>
              <option>High School Teacher</option>
            </select>
          </div>
        </div>

        <div class="row schoolname">  
          <div class="large-12 columns">
            <label>Schoo Name</label>
            <input type="text" name="schoolname" placeholder="Ryerson University">
          </div>
        </div>

        <div class="row degree">
          <div class="large-12 columns">
            <label>Degree</label>
            <input type="text" name="degree" placeholder="Economics">
          </div>
        </div>

        <div class="row listing-preview">
          <div class="large-12 columns">
            <label>Listing Preview</label>
            <p>(When students search for tutors, you will appear as):</p>
            <p class="preview">Under Graduate Degree Holder From Ryerson University Economics</p>
          </div>
        </div>
      </div>
      <input type="submit" class="bbutton" value="Save & Activate Tutor Status" name="tutorStatusButton">
    </form>
  </div>
  <a class="close-reveal-modal">&#215;</a>
</div>
<div id="turnTutorStatusOff" class="reveal-modal medium">
    <div class="row">
        <div class="large-12 columns">
            <h4>Are you sure you want to turn off your tutor status?</h4>
        </div>
    </div>
    <form>
        <div class="row">
            <div class="large-2 push-8 columns">
                <input type="submit" class="bbutton" value="Yes" name="tutorStatusButton">
            </div>
            <div class="large-2 columns">
                <input type="submit" class="bbutton" value="No" name="tutorStatusButton">
            </div>
        </div>
    </form>
    <a class="close-reveal-modal">&#215;</a>
</div>
<script type="text/javascript">
$(document).ready(function(){
  $('#tutorOn').click(function(){
      console.log('Checked');
      $('#myTutorModal').foundation('reveal', 'open');
  })
  $('#tutorOff').click(function(){
      console.log('Checked');
      $('#turnTutorStatusOff').foundation('reveal', 'open');
  })
});
</script>
<div id="buyPointsModal" class="reveal-modal medium">
	<div class="row">
		<form action="/paypal.php" method="post">
			<input type="hidden" name="loginid" value="{{app.user.id}}" />
			<input type="hidden" name="pack" value="500" />
			<input type="hidden" name="amount" value="5" />
			<input type="hidden" name="quantity" value="1" />
			Buy
			<select name="points">
				<option value="500" selected="selected">500</option>
				<option value="1000">1000</option>
				<option value="2500">2500</option>
				<option value="5000">5000</option>
				<option value="10000">10000</option>
			</select> for $5.00
		<input type="submit" name="Buy" />
		</form>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function(){
    //Submit Question
    $('input[name="aSubmit"]').click(function(e){
    	e.preventDefault();
    	$('.tutor-list').html('Loading ... ');
        $.ajax('{{path('rayku_tutor')}}')
		    .always(function(xhr, status) { 
				if(status === 'error' || !xhr.responseText){
					$('.tutor-list').html('There was an error loading tutors');
				}else{
					$('.tutor-list').html(xhr.responseText);
				}
			});
        $('.tutor-list').fadeIn('slow');
        $('.tutor-selected').fadeIn('fast');
        
        
        //disable all checkboxes for tutors that are busy
        $('form#tutorList :input').each(function(){
            var input = $(this);
            if($(this).attr("data-tutor-status") == 1){
                $(this).attr('disabled', true);
            }
        });

    });

    //set all busy tutors to show a red background
    $('table#tutorTable tr td').each(function(){
        var column = $(this);
        console.log(column);
        if(column.hasClass('busy')){
            column.find('a').addClass('tutor-busy');
        }
    });

    //Clear selected tutors
    $('.clear-tutors').click(function(event){
        event.preventDefault();
        tutorCount = 0; //set the selected tutor count back to 0
        tutorList.splice(0, tutorList.length); //delete all tutors from the tutor list
        $("#selectedTutors li").remove(); //remove selected tutors from ol list
        $('input[name="tutor"]').attr('checked', false); //set all checked tutors to unchecked
        $('span.tutor-count').html("0"); //reset the count on the page
    });
});
</script>
{% endblock %}