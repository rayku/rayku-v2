<!DOCTYPE html>
<html lang="en" xmlns:ng="http://angularjs.org"  id="ng-app" ng-app="raykuApp">
<head>
	<meta charset="utf-8">
	<title>{{user.username}} | Rayku</title>
	<link href="{{ asset('bundles/raykupage/css/normalize.css') }}" type="text/css" rel="stylesheet" media="screen" />
	<link href="{{ asset('bundles/raykupage/css/foundation.min.css') }}" type="text/css" rel="stylesheet" media="screen" />
	<link href="{{ asset('bundles/raykupage/css/app.css') }}" type="text/css" rel="stylesheet" media="screen" />
	<link rel="icon" type="image/ico" href="{{ asset('bundles/raykupage/images/favicon.ico') }}">

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
	<script src="{{ asset('components/ngUpload/ng-upload.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/app/loadingIndicator.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/foundation.min.js') }}"></script>
    <script src="{{ asset('bundles/raykupage/js/vendor/custom.modernizr.js') }}"></script>
	<script type="text/javascript" src="{{ asset('bundles/raykupage/js/script.js') }}"></script>
	
	<script src="{{ asset('bundles/raykupage/js/app/controller.js') }}"></script>

	<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/jquery_form/jquery.form.js') }}"></script>
	<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
	<script>
		var userId = {{ user.id }};
		var username = '{{ user.username }}';
		var whiteboardUrl = '{{ whiteboard_url }}';
	</script>
	
	<script type="text/javascript">
	window.setInterval(function(){
		$.get(Routing.generate('get_sessions', {'activeRequests':1}), function(response, status){
			jQuery.each(response, function() {
				var current_messages = parseInt($('.notif-count').html());
				$('.notif-count').html(response.length);
				var template = $('#connectRow_id_').prop("outerHTML");
				template = template.replace('_name_', this.student.first_name+' '+this.student.last_name);
				template = template.replace('_question_', this.question);
				template = template.replace(/_id_/g, this.id);
				if(response.length > current_messages){
					$('#connectNotifModal').append(template);
					$('#connectRow'+this.id).show();
					$('#music').html('<iframe src="/music.html" width="1" height="1"></iframe>');            
					$('#connectNotifModal').foundation('reveal', 'open');
				}
				$('.post_session_accept').ajaxForm(function(response) { 
				if(response.success){
					window.location.href = response.redirect;
				}else if(response.success !== false){
					alert(response.message);
				}else{
					alert('an unknown error has occured');
				}
			})
			$('.post_session_deny').ajaxForm(function(response) {
				if(response.success){
					$('#connectNotifModal').foundation('reveal', 'close');
					$('#music').html('');
				}
			})
		})
	})
}, 5000);
</script>
</head>
<body ng-controller="MainCtrl">
<div id="loading-indicator">
	<img src="{{ asset('bundles/raykupage/images/ajax-loader.gif') }}" />
</div>

<div id="whiteboard2">
    <div id="whiteboard-header">
    	{% verbatim %}
        <a href="{{ path('rayku_username_dashboard', {username:user.username}) }}" class="logged-in-as bbutton home">Back Home</a>
        {% endverbatim %}
    </div>
    <iframe src="" seamless></iframe>
</div>

<div class="container">
	<header id="header">
	    <div class="inside">
	    	{% verbatim %}
	    	<a href="{{ path('rayku_username_dashboard', {username:user.username}) }}" id="logo">
	    	{% endverbatim %}
	    		<span class="beta">beta</span><img src="{{ asset('bundles/raykupage/images/logo.png') }}" alt="" />
	    	</a>
	    	{% verbatim %}
	        <nav>
	        	<ul class="navigation">
	        	<li>
	        	<a href=# class="userRateLink"><span class="userRate">{{user.points}}</span>RP</a>
	        	</li>
	        	<li>
	        	<a href=# class="notification" data-reveal-id="connectNotifModal"><span class="raphael">[</span><span class="notif-count">0</span></a>
	        	</li>
				<li>
	        	<a href=# class="logged-in-as"><img ng-src="{{ user.web_path }}"/> <span class="logged-in-as-name">{{ user.first_name }}</span><div class="arrow-down"></div></a>  
	           
	            <div class="submenu" id="submenu">
                    <ul class="submenu-item">
                        <li><a class="dashboard" href="{{ path('rayku_username_dashboard', {username:user.username}) }}">Home</a><br><span class="nav-desc">Back to dashboard</span></li>
                        
                        <li><a class="setting" href="{{ path('angular_profile') }}">Profile</a><br><span class="nav-desc">Edit your profile</span></li>
                        <li><a class="myprofileedit" href="{{ path('angular_settings') }}">Settings</a><br><span class="nav-desc">Change settings</span></li>
                        <li><a class="tutor" href=# data-reveal-id="myTutorModal">Tutor</a><br><span class="nav-desc">Become a tutor</span></li>
                        
                        <li><a class="onboard" href="#/onboarding">Onboarding</a><br><span class="nav-desc">Tutor Training Tutorial</span></li>
                        <!-- <li><a class="tutor" href=# data-reveal-id="getStartedModal"><span class="raphael">u</span>Get Started</a></li> //-->
						
                        <li><a class="logout" href="{{ path('fos_user_security_logout') }}">Logout</a></li>
                    </ul>
                </div>
                </li>
            	</ul>
	        </nav>
	        {% endverbatim %}
	    </div>
	</header>
	<div class="row" id="main-content">
		{% if user.id is null %}
			{% include 'RaykuPageBundle:Page:registration_modal.html.twig' with {'form': registrationform} %}
		{% endif %}
		<!------------------------------
		SIDE NAVIGATION
		-------------------------------->
		<div class="slide-in">
			<div class="arrow-left">
			</div>
		</div>
		<div class="large-4 columns" id="sidebar" ng-controller="UserDetailCtrl">
			<div ng-include="UsernameTemplate"></div>
			<h3 class="userstatus"><span class="status">{% if user.isTutor %}Tutor{% endif %}{% if user.isTutor == false %}Student{% endif %}</span><span class="online">&nbsp;</span></h3>
			<div ng-include="SidebarDetailTemplate"></div>
			
			{% verbatim %}
			<ul class="sidebar-nav">
				<!--<li><a class="dashboard active" href="{{ path('rayku_username_dashboard', {username:user.username}) }}"><span class="raphael">S</span> Dashboard</a></li>
				<li><a class="myprofileedit" href="{{ path('angular_profile') }}"><span class="raphael">`</span> Settings</a></li>-->
				<li><a class="buyPoints" href=# data-reveal-id="buyPointsModal"><span class="raphael">#</span> Buy Points</a></li>
				<li><a class="userWhiteboard" href=#><span class="raphael">?</span> Practice</a></li>
				<!--<li class="backtoWhiteboard"><a class="backWhiteboard" href=#><span class="raphael">?</span> Back to Whiteboard</a></li>-->
			</ul>
			{% endverbatim %}
		</div>

		<div class="large-8 columns" id="content-body" ng-view></div>
	</div>


<div id="getStartedModal" class="reveal-modal medium">
	<div class="row header">
		<div class="large-12 columns">
			<h2><span>Profile Information</span></h2>
		</div>
	</div>
	<div class="row body">
		<div ng-controller="UserDetailCtrl">
			<div class="large-12 columns editprofileinfo">
				<form ng-upload="bar" action="{{ path('post_users', {'user':user.id}) }}">
				<ul class="userinfo">
					<li><span class="fname">First Name</span><span class="editfname"><input type="text" ng-model="user.first_name" name="first_name"></span></li>
					<li><span class="lname">Last Name</span><span class="editlname"><input type="text" ng-model="user.last_name" name="last_name"></span></li>
					<li><span class="username">Username</span><span class="editusername"><input type="text" ng-model="user.username" name="username"></span></li>
					<li><span class="degree">Degree</span><span class="editdegree"><input type="text" ng-model="user.degree" name="degree"></span></li>
					<li><span class="grade">Level Of Education</span><span class="editgrade"><input type="text" ng-model="user.grade" name="grade"></span></li>
					<li><span class="school">School</span><span class="editschool"><input type="text" ng-model="user.school" name="school"></span></li>
				</ul>
				<p><span>About (<span id="charNum"></span>)</span><span><textarea class="user-bio" ng-model="user.bio" name="bio" onkeyup="countChar(this)">{{ user.bio }}</textarea></span></p>
				<p class="profile-pic-field"><span>Profile Picture</span><span><input type="file" name="file" /></span></p>
				<div class="row">
					<div class="large-12">
						<input type="submit" upload-submit="update(contents, completed)" ng-click="refreshUser()" value="Save" class="bbutton startedSave" />
					</div>
				</div>
				</form>
			</div>
		</div>
	</div>
</div>

<div id="buyPointsModal" class="reveal-modal medium" ng-controller="BillingCtrl" ng-init="step = 1">
	<span ng-show="step == 1">
		<div class="row registration-header">
			<h2>Buy Rayku Points</h2>
		</div>
		<div class="row registration-body">
			<form name="invoiceform">
	            <select id="customDropdown1" class="large" ng-required="true" required ng-model="points.amount" required>
	                <option value="5">500 Points for $5</option>
	                <option value="10">1000 Points for $10</option>
	                <option value="25">2500 Points for $25</option>
	                <option value="50">5000 Points for $50</option>
	                <option value="100">10000 Points for $100</option>
	            </select><br />
	            <input type="checkbox" ng-model="points.recharge" /> Enable Auto-recharge <br />
	            Auto-recharge saves you time and hassle.  We'll credit your account with the amount selected when your balance falls below 100 Rayku Points<br /><br />
	
				{% verbatim %}
				<span ng-hide="user.credit_card == undefined">
					Your credit card ending with {{ user.credit_card.digits }} will be charged.<br />
					Change Credit Card on next step <input type="checkbox" ng-model="cc" /><br />
				</span>
				{% endverbatim %}
	            <br /><input type="submit" class="bbutton" value="Buy" ng-disabled="!invoiceform.$valid" ng-click="createInvoice()">
			</form>
		</div>
	</span>
	
	<span ng-show="step == 2">
		<div class="row registration-header">
			<h2>Credit Card</h2>
		</div>
		<div class="row registration-body">
			<form name="ccform">
				<label for="firstName">First Name</label>
				<input type="text" ng-model="card.firstName" placeholder="First Name" id="firstName" ng-required="true" required />
				<label for="lastName">Last Name</label>
	            <input type="text" ng-model="card.lastName" placeholder="Last Name" id="lastName" ng-required="true" required />
	            <label for="number">Card Number</label>
	            <input type="text" ng-model="card.number" placeholder="Card Number" id="number" ng-required="true" required />
	            <label for="expiryYear">Expires Year</label>
	            <input type="number" ng-model="card.expiryYear" placeholder="YY" min="13" max="35" id="expiryYear" ng-required="true" required />
	            <label for="expiryMonth">Expires Month</label>
	            <input type="number" ng-model="card.expiryMonth" placeholder="MM" min="1" max="12" id="expiryMonth" ng-required="true" required />
	            <label for="ccv">CCV</label>
	            <input type="number" ng-model="card.cvv" id="ccv" placeholder="CCV" min="100" max="900" ng-required="true" required />
	            <label for="type">Type of Card</label>
	            <input type="text" ng-model="card.type" id="type" placeholder="Credit Card Type" ng-required="true" required />
	            <label for="password">Current Password</label>
	            <input type="password" ng-model="card.current_password" id="password" ng-required="true" required />
	            <br /><input type="submit" class="bbutton" value="Buy" ng-disabled="!ccform.$valid" ng-click="chargeCard(card)">
			</form>
		</div>
	</span>
	
	<span ng-show="step == 3">
		Thanks
	</span>
	
	<a class="close-reveal-modal" ng-click="step = 1">×</a>
</div>


{% include 'RaykuPageBundle:Partials:activate_tutor_modal.html.twig' %}
{% include 'RaykuPageBundle:Partials:notification_modal.html.twig' %}

{% if ratesessionform is defined %}
	{% include 'RaykuPageBundle:Partials:rate_session_modal.html.twig' %}
{% endif %}

<script>
	document.write('<script src=' +
    ('__proto__' in {} ? '/bundles/raykupage/js/vendor/zepto' : '/bundles/raykupage/js/vendor/jquery') +
    '.js><\/script>')
</script>

<script src="{{ asset('bundles/raykupage/js/foundation/foundation.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.alerts.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.clearing.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.cookie.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.dropdown.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.forms.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.joyride.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.magellan.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.orbit.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.placeholder.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.reveal.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.section.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.tooltips.js') }}"></script>
<script src="{{ asset('bundles/raykupage/js/foundation/foundation.topbar.js') }}"></script>
<script>
    $(document).foundation();
</script>

{% include "::GoogleAnalytics.html.twig" %}

</body>
</html>
