<!DOCTYPE html>
<html lang="en" ng-app="raykuApp">
<head>
	<meta charset="utf-8">
	<title>{% block title %}Rayku{% endblock %}</title>
	<link href="{{ asset('bundles/raykupage/css/normalize.css') }}" type="text/css" rel="stylesheet" media="screen" />
	<link href="{{ asset('bundles/raykupage/css/foundation.css') }}" type="text/css" rel="stylesheet" media="screen" />
	<link href="{{ asset('bundles/raykupage/css/app.css') }}" type="text/css" rel="stylesheet" media="screen" />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
	<script src="{{ asset('components/ngUpload/ng-upload.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/app/loadingIndicator.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/foundation.min.js') }}"></script>
    <script src="{{ asset('bundles/raykupage/js/vendor/custom.modernizr.js') }}"></script>
	<script type="text/javascript" src="{{ asset('bundles/raykupage/js/script.js') }}"></script>
	
	<!--REQUIRE-->
	<script src="{{ asset('bundles/raykupage/js/require.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/main.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/app/controller.js') }}"></script>

	<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
	<script src="{{ asset('bundles/raykupage/js/jquery_form/jquery.form.js') }}"></script>
	<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
	<script>
		var userId = {{ user.id }};
	</script>
</head>
<body>
<div id="loading-indicator" style="opacity: 0.4; position: absolute; top: 0; left: 0; 
	background-color: black; width: 100%; z-index: 5000; position:fixed; text-align:center;">
	<img src="http://sierrafire.cr.usgs.gov/images/loading.gif" />
</div>

<div id="whiteboard2">
    <div id="whiteboard-header">
        <a href=# class="logged-in-as bbutton home">Back Home</a>
    </div>
    <iframe src="" seamless></iframe>
</div>
<script type="text/javascript">
$(document).ready(function(){
	//Create a session
	
	$('#create_session').submit(function() {
		$('#loading-indicator').fadeIn('fast');
	});
	
    $('#create_session').ajaxForm(function(response) {
    	if(response.success == true){
	        $('#whiteboard').src = response.redirect;
	        $('#whiteboard2 iframe').attr("src", response.redirect);
	        $('.container').animate({
	            display:'none'
	        });
	        $('body').css('overflow', 'hidden');
	        $('.main-header').fadeOut('fast');
	        $('#whiteboard2').fadeIn('slow');
	    }else{
	    	alert('There was an error starting your session');
	    }
	    $('#loading-indicator').fadeOut('slow');
    });
});
</script>
<div class="container">
	<header id="header">
	    <div class="inside">
	        <a href="{{ path('rayku_page_dashboard') }}" id="logo"><img src="http://www.rayku.local/bundles/raykupage/images/logo.png" alt="" /></a>
	        <nav>
	            <a href=# class="notification" data-reveal-id="connectNotifModal"><span class="raphael">M</span><span class="notif-count">0</span></a>
	            <a href=# class="settings"><span class="raphael">`</span></a>
	            <a href=# class="logged-in-as"><span class="liau">Logged in as {{user.username}}</span> <div class="arrow-down"></div></a> 
	            <div class="submenu" id="submenu">
                    <div class="arrow-up"></div>
                    <ul class="submenu-item">
                        <li><a class="dashboard" href=#><span class="raphael">L</span>Home</a></li>
                        <li><a class="setting" href=#><span class="raphael">`</span>Settings</a></li>
                        <li><a class="myprofileedit" href=#><span class="raphael">`</span>Edit Profile</a></li>
                        <li><a class="tutor" href=# data-reveal-id="myTutorModal"><span class="raphael">`</span>Become a Tutor</a></li>
                        <li><a class="logout" href="{{ path('fos_user_security_logout') }}"><span class="raphael">v</span>Logout</a></li>
                    </ul>
                </div>
	        </nav>
	    </div>
	</header>
	<div class="row" id="main-content">
		{% if user.id is null %}
			{% include 'RaykuPageBundle:Page:registration_modal.html.twig' with {'form': registrationform} %}
		{% endif %}
		<!------------------------------
		SIDE NAVIGATION
		-------------------------------->
		<div class="large-4 columns" id="sidebar" ng-controller="UserDetailCtrl">
			<div ng-include="UsernameTemplate"></div>
			<h3 class="userstatus"><span class="status">{% if user.isTutor %}Tutor{% endif %}{% if user.isTutor == false %}Student{% endif %}</span><span class="online">&nbsp;</span></h3>
			<ul class="sidebar-nav">
				<li class="divider"></li>
				<li class="active"><a class="dashboard" href=#><span class="raphael">S</span> Dashboard</a></li>
				<li class="divider"></li>
				<li><a class="profile" href=#><span class="raphael">L</span> Profile</a></li>
				<li class="divider"></li>
				<li><a class="buyPoints" href=#><span class="raphael">#</span> Buy Rayku Points</a></li>
				<li class="divider"></li>
				<li><a class="userWhiteboard" href=#><span class="raphael">?</span> Practice Whiteboard</a></li>
				<li class="divider"></li>
			</ul>
			<!--<ul class="logout">
				<li class="divider"></li>
				<li><a href=#><span class="raphael">Ï</span> Logout</a></li>
			</ul>-->
		</div>

		<div class="large-8 columns" id="content-body">
			<div class="row content-header">
				<h3><span class="raphael">S</span>Dashboard</h3>
			</div>
			<div class="row" id="content">
				<input type="text" placeholder="What is your question?">
				
			<!------------------------------
			TUTOR LIST TABLE
			-------------------------------->
				<div class="large-8 columns tutor-list" ng-controller="TutorListCtrl">
					<h3>Online Tutors<a href="#" class="raphael refreshTutors" ng-click="refreshTutors()">0</a></h3>
					<form action="{{path('post_session')}}" method="post" class="custom" id="create_session">
					<div ng-include="tutorListTemplate"></div>
					</form>
				</div>

				<div class="large-2 columns tutor-points">
					<h3><span class="raphael">#</span><span class="title">Rayku Points</span></h3>
					<h4>{{user.points}}</h4>
				</div>
				<div class="large-2 columns tutor-rating">
					<h3><span class="raphael">$</span><span class="title">Tutor Rating<span></h3>
					<h4>1000</h4>
				</div>

			<!------------------------------
			PAST SESSIONS LIST
			-------------------------------->
				<div class="large-4 columns" id ="sessions-list" ng-controller="SessionListCtrl">
					<h3>Sessions</h3> 
					<div ng-include="SessionListTemplate"></div>
				</div>
			</div>
			
			<!------------------------------
			USER PROFILE
			-------------------------------->
			<div class="row userprofile" id="userprofile">
				<div class="large-12 columns" id="profile">
					<h3>User Profile</h3>
					<div class="row">
						<div class="large-3 columns sidenav" ng-controller="UserDetailCtrl">
							{% verbatim %}
							<img ng-src="{{ user.web_path }}" style="width:100%;">
							{% endverbatim %}
							<ul class="profilenav">
								<li><a href=# class="myprofile">Profile</a></li>
								<li><a href=# class="payout">Payout</a></li>
								<li><a href=# class="mysettings">Settings</a></li>
							</ul>
						</div>

						<div ng-controller="UserDetailCtrl">
							<div class="large-9 columns profileinfo">
								<div ng-include="UserDetailTemplate"></div>
								{% if user.isTutor %}
									<p class="public"><a href="{{ path('rayku_tutor_show', { 'username': user.username } ) }}"><span class="raphael">7</span>Tutor Public Profile</a></p>
								{% endif %}

							</div>
							<div class="large-9 columns editprofileinfo">
								<form ng-upload="bar" action="{{ path('post_users', {'user':app.user.id}) }}">
								{% verbatim %}
								<h4 class="username">Edit Profile</h4>
								<ul class="userinfo">
									<li><span class="fname">First Name</span><span class="editfname"><input type="text" ng-model="user.first_name" name="first_name"></span></li>
									<li><span class="lname">Last Name</span><span class="editlname"><input type="text" ng-model="user.last_name" name="last_name"></span></li>
									<li><span class="degree">Degree</span><span class="editdegree"><input type="text" ng-model="user.degree" name="degree"></span></li>
									<li><span class="grade">Level Of Education</span><span class="editgrade"><input type="text" ng-model="user.grade" name="grade"></span></li>
									<li><span class="school">School</span><span class="editschool"><input type="text" ng-model="user.school" name="school"></span></li>
								</ul>
								<p><span>About</span><span><textarea ng-model="user.bio" name="bio">{{ user.bio }}</textarea></span></p>
								<p><span>Profile Picture</span><span><input class="bbutton" type="file" name="file" /></span></p>
								<div class="row">
									<input type="submit" upload-submit="update(contents, completed)" value="Save" class="bbutton" />
								</div>
								</form>
								
								<div>{{uploadReport}}</div>
								
								{% endverbatim %}
							</div>
							<div class="large-9 columns profilesettings">
								<form novalidate>
								<h4 class="username">Settings</h4>
								<ul class="userinfo">
									<li><span class="username">Username</span><span><input type="text" ng-model="user.username" name="username"></span></li>
									<li><span class="email">Email</span><span><input type="text" ng-model="user.email" name="email"></span></li>
									<li><span class="password">Current Password</span><span><input type="password" ng-model="user.current_password" name="current_password" value="" autocomplete="off"></span></li>
									<li><span class="password">New Password</span><span><input type="password" ng-model="user.plainPassword.first" name="plainPassword[first]"></span></li>
									<li><span class="password">Confirm Password</span><span><input type="password" ng-model="user.plainPassword.second" name="plainPassword[second]"></span></li>
								</ul>
								<div row>
									<input type="submit" class="bbutton" value="Save Settings" ng-click="profile(user)" />
								</div>
								</form>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!------------------------------
MODALS
-------------------------------->
{% if user.id %}
<div id="myTutorModal" class="reveal-modal medium" ng-controller="TutorListCtrl">
	<div class="row registration-header">
		<h2>Tutor Profile</h2>
	</div>
	<div class="row registration-body">
		<p>Before activating your tutor status, please fill out as much as possible to completeyour tutor profile.</p>
	</div>
	
	<div class="large-12 columns">
    <form novalidate>
		<div class="row">
		<div class="row degree"><div class="large-12 columns">
			<label for="rate" class="required">RP/Min $1 = 100 RP</label>
			<input type="text" id="rate" name="rate" required="required" ng-model="user.tutor.rate">
		</div></div>
        <div class="row degree"><div class="large-12 columns">
        	<label for="gtalk_email">Connect Your Google Talk</label>
        	<input type="email" id="gtalk_email" name="gtalk_email" maxlength="255" ng-model="user.tutor.gtalk_email">
        </div></div>
        <div class="row degree"><div class="large-12 columns">
        	<label style="width:110px; float:left; height:1px" for="visible" class="required hast-tip" data-tooltip="" title="You can only be connected with directly through your tutor profile page">Direct Connect Only</label>
        	<input type="checkbox" id="direct_connect" name="direct_connect" data-customforms="disabled" value="1"  ng-model="user.tutor.direct_connect">
        </div></div>
        <div class="row listing-preview"><div class="large-12 columns">
        	<br />
        	<label>Listing Preview</label>
        	<p>(When students search for tutors, you will appear as):</p>
        	<p class="preview"><span class="schoolAmount">Under Graduate Degree Holder</span> From <span class="schoolName">Ryerson University</span> - Economics</p>
        </div></div>
    </div>
    <input type="submit" class="bbutton" value="Save &amp; Activate Tutor Status"  ng-click="update(user)" />
    </form>
	</div>
	<a class="close-reveal-modal">×</a>
</div>

	{% include 'RaykuPageBundle:Page:notification_modal.html.twig' %}
{% endif %}

{% if ratesessionform is defined %}
	<div id="referFriend" class="reveal-modal medium">
		<div class="row registration-header">
        	<h2>Refer a Friend</h2>
		</div>
	    <div class="row registration-body">
			<div class="large-12 columns">
				You can get extra Rayku Points by inviting your friends to try out Rayku. If a friend uses your invitation to sign up for an account you will receive 200 Rayku Points and your friend receives 500 Rayku points.</br><br/>
				
				<input type="text" value="http://www.rayku.com/?refcode={{ user.referralCode }}" /><br /><br />

				<a href="#"><img src="https://secure.citizensforethics.org/page/-/images/buttons/btn_fb_55px.gif" /></a>
			</div>
		</div>
		<a class="close-reveal-modal">×</a>
	</div>
	
	<div id="rateTutorModal" class="reveal-modal medium rateTutor">
		<div class="row registration-header">
        	<h2>Rate Your Tutor</h2>
		</div>
		<div class="row registration-body">
	    <div class="large-12 columns rate-tutors">
	        <form id="rateTutorForm" class="custom" name="rate-tutor" action="{{ path('post_session_rate', {'session': session.id}) }}" method="post">
	            <div class="row">
	                <div class="large-9 columns">
	                    <label for="rateTutor">{{ session.selectedtutor }}</label>
	                    {{ form_widget(ratesessionform.rating) }}
	                    {{ form_rest(ratesessionform) }}
	                </div>
	
	                <!--// Attach to a review table on DB //-->
	                <div class="large-12 columns">
	                    <form>
	                        <div class="row">
	                            <div class="large-12 columns">
	                                <label>Write Review</label>
	                                <textarea placeholder="small-12.columns">Write a tutor review</textarea>
	                            </div>
	                        </div>
	                    </form>
	                </div>
	                <div class="large-3 columns">
	                    <input type="submit" class="bbutton" value="Rate">
	                </div>
	            </div>
	            <div class="row">
	            	<div class="large-12 coumns">
	            		View the <strong><a href="{{ whiteboard_url }}/room/{{ session.id }}/playback/5" target="_blank" />Session Recording</a></strong>
	            	</div>
	            </div>
	        </form>
	    </div></div>
	</div>
	
	<script type="text/javascript">
	$(document).ready(function(){
		$('#rateTutorModal').foundation('reveal', 'open');
	    $('#rateTutorForm').ajaxForm(function() {
	    	if($('select#rating').find(":selected").val() > 3){
	    		$('#referFriend').foundation('reveal', 'open')    	
	    	}else{
		    	$('#rateTutorModal').foundation('reveal', 'close');
		    }
		});
	});
	</script>
{% endif %}

 <script>
    document.write('<script src=' +
    ('__proto__' in {} ? '/bundles/raykupage/js/vendor/zepto' : '/bundles/raykupage/js/vendor/jquery') +
    '.js><\/script>')
</script>

{% javascripts
    '@RaykuPageBundle/Resources/public/js/foundation//*' %}
    <script src="{{ asset_url }}"></script>
{% endjavascripts %}

<script>
    $(document).foundation();
</script>

{% include "::GoogleAnalytics.html.twig" %}
</body>
</html>